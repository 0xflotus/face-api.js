{"version":3,"sources":["webpack:///./src/components/FacePreview.tsx","webpack:///./src/pages/face_recognition.tsx","webpack:///./node_modules/gatsby/node_modules/core-js/modules/es6.function.name.js","webpack:///./node_modules/gatsby/node_modules/core-js/modules/es6.array.find-index.js","webpack:///./node_modules/gatsby/node_modules/core-js/modules/es6.array.sort.js","webpack:///./node_modules/gatsby/node_modules/core-js/modules/_strict-method.js"],"names":["NameInput","Mui","className","width","textAlign","props","value","onChange","classes","Container","styled","div","FaceContainer","Canvas","canvas","RemoveIcon","MuiIcons","FacePreview","state","isHovered","onRef","ref","updateCanvas","face","faceapi","drawImage","onMouseEnter","setState","onMouseLeave","componentDidUpdate","componentDidMount","render","onRemove","name","e","onNameChanged","target","React","FacesContainer","FaceWithDescriptors","descriptor","id","copyWithName","ChildPage","facesWithDescriptors","sort","f0","f1","localeCompare","map","newName","onChangeFaceWithDescriptorName","onRemoveFaceWithDescriptor","cachedResults","displayResults","element","overlay","labeledFacesWithDescriptors","filter","f","labeledDescriptors","dimensions","HTMLVideoElement","resizedResults","length","drawDetections","faceMatcher","forEach","res","DrawBox","alignedRect","box","label","findBestMatch","toString","draw","runFaceRecognition","mediaElement","isFaceDetectorLoaded","areModelsLoaded","faceDetectionOptions","withFaceLandmarks","withFaceDescriptors","onFaceWithDescriptorsChanged","inputType","InputType","IMAGE","idx","findIndex","newFaceWithDescriptors","slice","onUploadReferenceImage","file","files","img","results","faces","i","Date","now","loadModels","Promise","all","faceRecognitionNet","loadFromUri","MODELS_URI","processInputs","marginLeft"],"mappings":"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","file":"component---src-pages-face-recognition-tsx-4762e0f7b438862f9257.js","sourcesContent":["import * as Mui from '@material-ui/core';\r\nimport * as faceapi from 'face-api.js';\r\nimport * as React from 'react';\r\nimport styled from 'styled-components';\r\nimport * as MuiIcons from '@material-ui/icons';\r\n\r\n\r\nconst NameInput = Mui.withStyles({ className: { width: 120, textAlign: 'center' } })(\r\n  (props: { classes: any, value: string, onChange: (value: React.ChangeEvent<HTMLInputElement>) => any }) =>\r\n    <Mui.Input\r\n      value={props.value}\r\n      onChange={props.onChange}\r\n      className={props.classes.className}\r\n      placeholder=\"Give me a name!\"\r\n    />\r\n)\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n`\r\n\r\nconst FaceContainer = styled.div`\r\n  position: relative;\r\n  width: 120px;\r\n  height: 100px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  margin: 4px;\r\n`\r\n\r\nconst Canvas = styled.canvas`\r\n  max-width: 120px;\r\n  max-height: 100px;\r\n`\r\n\r\nconst RemoveIcon = styled(MuiIcons.DeleteOutlined)`\r\n  position: absolute;\r\n  top: 0;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  color: rgb(255, 50, 50);\r\n  width: 100% !important;\r\n  height: 100% !important;\r\n  cursor: pointer;\r\n`\r\n\r\nexport type FacePreviewProps = {\r\n  face: HTMLCanvasElement\r\n  name: string\r\n  onNameChanged: (name: string) => any\r\n  onRemove: (_: any) => any\r\n}\r\n\r\nexport type FacePreviewState = {\r\n  isHovered: boolean\r\n}\r\n\r\nexport class FacePreview extends React.Component<FacePreviewProps, FacePreviewState> {\r\n  state = {\r\n    isHovered: false\r\n  }\r\n\r\n  ref: HTMLCanvasElement\r\n\r\n  onRef = (ref: HTMLCanvasElement) => {\r\n    this.ref = ref\r\n    this.updateCanvas()\r\n  }\r\n\r\n  updateCanvas = () => {\r\n    if (this.ref && this.props.face) {\r\n      faceapi.matchDimensions(this.ref, this.props.face)\r\n      faceapi.getContext2dOrThrow(this.ref).drawImage(this.props.face, 0, 0)\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.updateCanvas()\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.updateCanvas()\r\n  }\r\n\r\n  onMouseEnter = () => {\r\n    this.setState({ isHovered: true })\r\n  }\r\n\r\n  onMouseLeave = () => {\r\n    this.setState({ isHovered: false })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Container>\r\n        <FaceContainer\r\n          onMouseEnter={this.onMouseEnter}\r\n          onMouseLeave={this.onMouseLeave}\r\n        >\r\n          <Canvas ref={this.onRef} />\r\n          { this.state.isHovered ? <RemoveIcon onClick={this.props.onRemove} /> : null }\r\n        </FaceContainer>\r\n        <NameInput\r\n          value={this.props.name}\r\n          onChange={e => this.props.onNameChanged(e.target.value)}\r\n        />\r\n      </Container>\r\n    )\r\n  }\r\n}","import * as Mui from '@material-ui/core';\r\nimport * as MuiIcons from '@material-ui/icons';\r\nimport * as faceapi from 'face-api.js';\r\nimport * as React from 'react';\r\nimport styled from 'styled-components';\r\n\r\nimport { FacePreview } from '../components/FacePreview';\r\nimport { InputType } from '../components/InputTypeTabs';\r\nimport { MODELS_URI } from '../const';\r\nimport { BasePage, BasePageState } from '../container/BasePage';\r\n\r\nconst Container = styled.div`\r\n  max-width: 100%;\r\n  width: 100%;\r\n  margin: 12px 0;\r\n`\r\n\r\nconst FacesContainer = styled.div`\r\n  height: 160px;\r\n  max-width: 100%;\r\n  width: 100%;\r\n  padding: 8px 0;\r\n  display: flex;\r\n  overflow-x: scroll;\r\n`\r\n\r\nexport class FaceWithDescriptors {\r\n  constructor(\r\n    public face: HTMLCanvasElement,\r\n    public descriptor: Float32Array,\r\n    public id: string,\r\n    public name: string = '',\r\n  ) {\r\n  }\r\n\r\n  copyWithName(name: string) {\r\n    return new FaceWithDescriptors(this.face, this.descriptor, this.id, name)\r\n  }\r\n}\r\n\r\nexport type ChildPageProps = BasePageState & {\r\n  facesWithDescriptors: FaceWithDescriptors[]\r\n  onChangeFaceWithDescriptorName: (id: string, name: string) => any\r\n  onRemoveFaceWithDescriptor: (id: string) => any\r\n}\r\n\r\nclass ChildPage extends React.Component<ChildPageProps> {\r\n\r\n  public render() {\r\n    return(\r\n      <Container>\r\n        <FacesContainer>\r\n          {\r\n            this.props.facesWithDescriptors\r\n              .sort((f0, f1) => f0.name.localeCompare(f1.name))\r\n              .map(({ face, name, id }) =>\r\n                <FacePreview\r\n                  key={id}\r\n                  face={face}\r\n                  name={name}\r\n                  onNameChanged={newName => this.props.onChangeFaceWithDescriptorName(id, newName)}\r\n                  onRemove={() => this.props.onRemoveFaceWithDescriptor(id)}\r\n                />\r\n              )\r\n          }\r\n        </FacesContainer>\r\n      </Container>\r\n    )\r\n  }\r\n}\r\n\r\nexport type PageState = {\r\n  facesWithDescriptors: FaceWithDescriptors[]\r\n}\r\n\r\nexport default class extends React.Component<{}, PageState> {\r\n  state: PageState = {\r\n    facesWithDescriptors: []\r\n  }\r\n  cachedResults: faceapi.WithFaceDescriptor<faceapi.WithFaceLandmarks<faceapi.WithFaceDetection<{}>>>[] = []\r\n\r\n  displayResults = (\r\n    element: faceapi.TMediaElement,\r\n    overlay: HTMLCanvasElement,\r\n    facesWithDescriptors: FaceWithDescriptors[]\r\n  ) => {\r\n    const labeledFacesWithDescriptors = facesWithDescriptors.filter(f => !!f.name)\r\n    const labeledDescriptors = labeledFacesWithDescriptors.map(\r\n      f0 => new faceapi.LabeledFaceDescriptors(\r\n        f0.name,\r\n        labeledFacesWithDescriptors\r\n          .filter(f1 => f0.name === f1.name)\r\n          .map(f1 => f1.descriptor)\r\n      )\r\n    )\r\n\r\n    const dimensions = faceapi.matchDimensions(overlay, overlay, element instanceof HTMLVideoElement)\r\n    const resizedResults = faceapi.resizeResults(this.cachedResults, dimensions)\r\n\r\n    if (!labeledDescriptors.length) {\r\n      faceapi.draw.drawDetections(overlay, resizedResults)\r\n      return\r\n    }\r\n\r\n    const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors)\r\n    resizedResults.forEach(res =>\r\n      new faceapi.draw.DrawBox(res.alignedRect.box, { label: faceMatcher.findBestMatch(res.descriptor).toString() })\r\n        .draw(overlay)\r\n    )\r\n  }\r\n\r\n  runFaceRecognition = async(state: BasePageState, facesWithDescriptors: FaceWithDescriptors[]) => {\r\n    const { mediaElement, overlay, isFaceDetectorLoaded, areModelsLoaded, faceDetectionOptions } = state\r\n\r\n    if (!mediaElement || !overlay || !isFaceDetectorLoaded || !areModelsLoaded) {\r\n      return\r\n    }\r\n\r\n    const { element } = mediaElement\r\n\r\n    this.cachedResults = await faceapi.detectAllFaces(element, faceDetectionOptions)\r\n      .withFaceLandmarks()\r\n      .withFaceDescriptors()\r\n\r\n    this.displayResults(element, overlay, facesWithDescriptors)\r\n  }\r\n\r\n  onFaceWithDescriptorsChanged = (state: BasePageState, facesWithDescriptors: FaceWithDescriptors[]) => {\r\n    this.setState({ facesWithDescriptors })\r\n    if (state.inputType === InputType.IMAGE) {\r\n      this.runFaceRecognition(state, facesWithDescriptors)\r\n    }\r\n  }\r\n\r\n  onChangeFaceWithDescriptorName = (state: BasePageState, id: string, newName: string) => {\r\n    const { facesWithDescriptors } = this.state\r\n    const idx = facesWithDescriptors.findIndex(f => f.id === id)\r\n    const newFaceWithDescriptors = [\r\n      ...facesWithDescriptors.slice(0, idx),\r\n      facesWithDescriptors[idx].copyWithName(newName),\r\n      ...facesWithDescriptors.slice(idx + 1)\r\n    ]\r\n    this.onFaceWithDescriptorsChanged(state, newFaceWithDescriptors)\r\n  }\r\n\r\n  onRemoveFaceWithDescriptor = (state: BasePageState, id: string) => {\r\n    const { facesWithDescriptors } = this.state\r\n    const idx = facesWithDescriptors.findIndex(f => f.id === id)\r\n    const newFaceWithDescriptors = [\r\n      ...facesWithDescriptors.slice(0, idx),\r\n      ...facesWithDescriptors.slice(idx + 1)\r\n    ]\r\n    this.onFaceWithDescriptorsChanged(state, newFaceWithDescriptors)\r\n  }\r\n\r\n  onUploadReferenceImage = async (state: BasePageState, { target } : any) => {\r\n    const file = target.files[0]\r\n    const img = await faceapi.bufferToImage(file)\r\n    const results = await faceapi.detectAllFaces(img, state.faceDetectionOptions)\r\n      .withFaceLandmarks()\r\n      .withFaceDescriptors()\r\n    const faces = await faceapi.extractFaces(img, results.map(res => res.alignedRect))\r\n    const newFaceWithDescriptors = faces.map((face, i) =>\r\n      new FaceWithDescriptors(face, results[i].descriptor, `${Date.now()}_${i}`)\r\n    )\r\n\r\n    this.onFaceWithDescriptorsChanged(state, [...this.state.facesWithDescriptors, ...newFaceWithDescriptors])\r\n  }\r\n\r\n  loadModels = async() => {\r\n    await Promise.all([\r\n      faceapi.nets.faceRecognitionNet.loadFromUri(MODELS_URI)\r\n    ])\r\n  }\r\n\r\n  processInputs = async(state: BasePageState) => {\r\n    this.runFaceRecognition(state, this.state.facesWithDescriptors)\r\n  }\r\n\r\n  public render() {\r\n    return(\r\n      <BasePage\r\n        loadAdditionalModels={this.loadModels}\r\n        processInputs={this.processInputs}\r\n        renderControls={state =>\r\n          <Mui.Button variant=\"contained\" color=\"primary\" component=\"label\" style={{ marginLeft: 10 }}>\r\n            <input type=\"file\" hidden onChange={e => this.onUploadReferenceImage(state, e)} />\r\n            Upload Reference Image\r\n            <MuiIcons.Add/>\r\n          </Mui.Button>\r\n        }\r\n        renderChildren={state =>\r\n          <ChildPage\r\n            {...state}\r\n            {...this.state}\r\n            onChangeFaceWithDescriptorName={(id, name) => this.onChangeFaceWithDescriptorName(state, id, name)}\r\n            onRemoveFaceWithDescriptor={id => this.onRemoveFaceWithDescriptor(state, id)}\r\n          />\r\n        }\r\n      />\r\n    )\r\n  }\r\n}","var dP = require('./_object-dp').f;\nvar FProto = Function.prototype;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// 19.2.4.2 name\nNAME in FProto || require('./_descriptors') && dP(FProto, NAME, {\n  configurable: true,\n  get: function () {\n    try {\n      return ('' + this).match(nameRE)[1];\n    } catch (e) {\n      return '';\n    }\n  }\n});\n","'use strict';\n// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)\nvar $export = require('./_export');\nvar $find = require('./_array-methods')(6);\nvar KEY = 'findIndex';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\nrequire('./_add-to-unscopables')(KEY);\n","'use strict';\nvar $export = require('./_export');\nvar aFunction = require('./_a-function');\nvar toObject = require('./_to-object');\nvar fails = require('./_fails');\nvar $sort = [].sort;\nvar test = [1, 2, 3];\n\n$export($export.P + $export.F * (fails(function () {\n  // IE8-\n  test.sort(undefined);\n}) || !fails(function () {\n  // V8 bug\n  test.sort(null);\n  // Old WebKit\n}) || !require('./_strict-method')($sort)), 'Array', {\n  // 22.1.3.25 Array.prototype.sort(comparefn)\n  sort: function sort(comparefn) {\n    return comparefn === undefined\n      ? $sort.call(toObject(this))\n      : $sort.call(toObject(this), aFunction(comparefn));\n  }\n});\n","'use strict';\nvar fails = require('./_fails');\n\nmodule.exports = function (method, arg) {\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call\n    arg ? method.call(null, function () { /* empty */ }, 1) : method.call(null);\n  });\n};\n"],"sourceRoot":""}