{"version":3,"sources":["webpack:///./src/VideoWrap.ts","webpack:///./src/components/AdjustableInput.tsx","webpack:///./src/components/MtcnnParamControls.tsx","webpack:///./src/components/WebcamVideoWithOverlay.tsx","webpack:///./src/facc/DetectFacesMtcnn.tsx","webpack:///./src/pages/face_detection_webcam_mtcnn.tsx"],"names":[],"mappings":"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","file":"component---src-pages-face-detection-webcam-mtcnn-tsx-d2b11c8510db612de088.js","sourcesContent":["export class VideoWrap {\r\n  private _video: HTMLVideoElement | undefined\r\n\r\n  constructor(video?: HTMLVideoElement | VideoWrap) {\r\n    if (!video) {\r\n      return\r\n    }\r\n\r\n    if (video instanceof VideoWrap) {\r\n      this._video = video.video\r\n      return\r\n    }\r\n\r\n    this._video = video\r\n  }\r\n\r\n  public get video(): HTMLVideoElement | undefined {\r\n    return this._video\r\n  }\r\n\r\n  public get element(): HTMLVideoElement | undefined {\r\n    return this.video\r\n  }\r\n\r\n  public get isLoaded(): boolean {\r\n    return this.video instanceof HTMLVideoElement\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/VideoWrap.ts","import { Button, FormControl, Input, InputLabel } from '@material-ui/core';\r\nimport * as React from 'react';\r\nimport styled from 'styled-components';\r\nimport { SideBySide } from '../styled/SideBySide';\r\n\r\nexport const StyledFormControl = styled(FormControl)`\r\n  margin: 10px !important;\r\n`\r\n\r\nexport const StyledButton = styled(Button)`\r\n  width: 40px;\r\n  height: 40px;\r\n`\r\n\r\nexport type AdjustableInputProps = {\r\n  inputId: string\r\n  label: string\r\n  value: number\r\n  minValue: number\r\n  maxValue: number\r\n  step: number\r\n  onChange: (newValue: number) => any\r\n}\r\n\r\nexport const AdjustableInput = (props: AdjustableInputProps) =>\r\n  <StyledFormControl>\r\n    <SideBySide>\r\n      <InputLabel htmlFor={props.inputId}>\r\n        { props.label }\r\n      </InputLabel>\r\n      <Input\r\n        id={props.inputId}\r\n        value={props.value}\r\n      />\r\n      <StyledButton\r\n        variant=\"outlined\"\r\n        onClick={\r\n          () => props.onChange(Math.max(props.value - props.step, props.minValue))\r\n        }\r\n      >\r\n        -\r\n      </StyledButton>\r\n      <StyledButton\r\n        variant=\"outlined\"\r\n        onClick={\r\n          () => props.onChange(Math.min(props.value + props.step, props.maxValue))\r\n        }\r\n      >\r\n        +\r\n      </StyledButton>\r\n    </SideBySide>\r\n  </StyledFormControl>\n\n\n// WEBPACK FOOTER //\n// ./src/components/AdjustableInput.tsx","import * as React from 'react';\r\n\r\nimport { MtcnnForwardParams } from '../../node_modules/face-api.js/build/mtcnn/types';\r\nimport { CenterContent } from '../styled/CenterContent';\r\nimport { AdjustableInput } from './AdjustableInput';\r\n\r\nexport interface MtcnnParamControlsProps {\r\n  detectionParams: MtcnnForwardParams\r\n  onChange: (detectionParams: MtcnnForwardParams) => any\r\n}\r\n\r\nexport const MtcnnParamControls = (props: MtcnnParamControlsProps) =>\r\n  <CenterContent flexDirection=\"column\">\r\n    <AdjustableInput\r\n      inputId=\"scaleFactor\"\r\n      label=\"scaleFactor:\"\r\n      value={props.detectionParams.scaleFactor}\r\n      minValue={0.1}\r\n      maxValue={0.9}\r\n      step={0.05}\r\n      onChange={\r\n        (scaleFactor: number) => props.onChange({ ...props.detectionParams, scaleFactor })\r\n      }\r\n    />\r\n    <AdjustableInput\r\n      inputId=\"minFaceSize\"\r\n      label=\"minFaceSize:\"\r\n      value={props.detectionParams.minFaceSize}\r\n      minValue={40}\r\n      maxValue={400}\r\n      step={40}\r\n      onChange={\r\n        (minFaceSize: number) => props.onChange({ ...props.detectionParams, minFaceSize })\r\n      }\r\n    />\r\n  </CenterContent>\n\n\n// WEBPACK FOOTER //\n// ./src/components/MtcnnParamControls.tsx","import * as faceapi from 'face-api.js';\r\nimport * as React from 'react';\r\n\r\nimport { VideoWrap } from '../VideoWrap';\r\n\r\nexport type WebcamVideoWithOverlayProps = {\r\n  onLoaded: (refs: { video: VideoWrap, overlay: HTMLCanvasElement}) => any\r\n  maxVideoWidth?: number\r\n}\r\n\r\nexport class WebcamVideoWithOverlay extends React.Component<WebcamVideoWithOverlayProps> {\r\n  video: HTMLVideoElement | undefined\r\n  overlay: HTMLCanvasElement | undefined\r\n  isLoaded: boolean = false\r\n\r\n  constructor(props: WebcamVideoWithOverlayProps) {\r\n    super(props)\r\n\r\n    this.onChange = this.onChange.bind(this)\r\n    this.onVideoRef = this.onVideoRef.bind(this)\r\n    this.onCanvasRef = this.onCanvasRef.bind(this)\r\n    this.onPlay = this.onPlay.bind(this)\r\n  }\r\n\r\n  onChange() {\r\n    const { video, overlay, isLoaded } = this\r\n\r\n    if (video && overlay && isLoaded) {\r\n      const { width, height } = faceapi.getMediaDimensions(this.video)\r\n      this.overlay.width = width,\r\n      this.overlay.height = height\r\n      this.props.onLoaded({ video: new VideoWrap(video), overlay })\r\n    }\r\n  }\r\n\r\n  onVideoRef(el: HTMLVideoElement) {\r\n    this.video = el\r\n    this.onChange()\r\n    navigator.getUserMedia(\r\n      { video: {} },\r\n      stream => {\r\n        this.video.srcObject = stream\r\n      },\r\n      err => console.error(err)\r\n    )\r\n  }\r\n\r\n  onCanvasRef(el: HTMLCanvasElement) {\r\n    this.overlay = el\r\n    this.onChange()\r\n  }\r\n\r\n  onPlay() {\r\n    this.isLoaded = true\r\n    this.onChange()\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps: WebcamVideoWithOverlayProps) {\r\n    return false\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.onChange()\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.onChange()\r\n  }\r\n\r\n  public render() {\r\n    return(\r\n      <div style={{ position: 'relative' }}>\r\n        <video\r\n          muted\r\n          autoPlay\r\n          style={{ maxWidth: this.props.maxVideoWidth }}\r\n          ref={this.onVideoRef}\r\n          onPlay={this.onPlay}\r\n        />\r\n        <canvas\r\n          style={{ position: 'absolute', top: 0, left: 0 }}\r\n          ref={this.onCanvasRef}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/WebcamVideoWithOverlay.tsx","import * as faceapi from 'face-api.js';\nimport * as React from 'react';\n\nimport { MtcnnForwardParams, MtcnnResult } from '../../node_modules/face-api.js/build/mtcnn/types';\nimport { ModalLoader } from '../components/ModalLoader';\nimport { withAsyncRendering } from '../hoc/withAsyncRendering';\nimport { ImageWrap } from '../ImageWrap';\nimport { VideoWrap } from '../VideoWrap';\n\nexport interface DetectFacesMtcnnProps {\n  mtcnn: faceapi.Mtcnn\n  input: ImageWrap | VideoWrap\n  detectionParams: MtcnnForwardParams\n}\n\nexport interface DetectFacesMtcnnState {\n  mtcnnResults: MtcnnResult[] | null\n}\n\nasync function detectFaces(props: DetectFacesMtcnnProps) {\n  const mtcnnResults = await props.mtcnn.forward(props.input.element, props.detectionParams)\n\n  return {\n    mtcnnResults\n  }\n}\n\nexport const DetectFacesMtcnn = withAsyncRendering<DetectFacesMtcnnProps, DetectFacesMtcnnState>(\n  detectFaces,\n  () => <ModalLoader title=\"Detecting Faces\"/>\n)\n\n\n\n// WEBPACK FOOTER //\n// ./src/facc/DetectFacesMtcnn.tsx","import * as faceapi from 'face-api.js';\nimport * as React from 'react';\n\nimport { MtcnnForwardParams } from '../../node_modules/face-api.js/build/mtcnn/types';\nimport { MtcnnParamControls } from '../components/MtcnnParamControls';\nimport { WebcamVideoWithOverlay } from '../components/WebcamVideoWithOverlay';\nimport { DetectFacesMtcnn } from '../facc/DetectFacesMtcnn';\nimport { LoadModels } from '../facc/LoadModels';\nimport { Root } from '../Root';\nimport { VideoWrap } from '../VideoWrap';\n\ntype FaceDetectionWebcamMtcnnPageState = {\n  inputVideo: VideoWrap\n  detectionParams: MtcnnForwardParams\n  isPlaying: boolean\n  overlay?: HTMLCanvasElement\n}\n\nexport default class extends React.Component<{}, FaceDetectionWebcamMtcnnPageState> {\n  isBusy: boolean = true\n  interval: NodeJS.Timer\n\n  constructor(props: {}) {\n    super(props)\n\n    this.state = {\n      inputVideo: new VideoWrap(),\n      isPlaying: false,\n      detectionParams: {\n        minFaceSize: 200,\n        scaleFactor: 0.8\n      }\n    }\n\n    this.interval = setInterval(() => {\n      if (this.isBusy) {\n        return\n      }\n      this.isBusy = true\n      this.setState({ inputVideo: new VideoWrap(this.state.inputVideo) })\n    }, 16)\n  }\n\n  public render() {\n    if (!(typeof window !== 'undefined' && window.document) ){\n      return null\n    }\n\n    return(\n      <Root>\n        <WebcamVideoWithOverlay\n          onLoaded={({ video: inputVideo, overlay }) => this.setState({ inputVideo, overlay })}\n          maxVideoWidth={800}\n        />\n        <MtcnnParamControls\n          detectionParams={this.state.detectionParams}\n          onChange={detectionParams => this.setState({ detectionParams })}\n        />\n        <LoadModels mtcnnModelUrl={'/models'}>\n        {\n          ({ mtcnn }) =>\n            <DetectFacesMtcnn\n              mtcnn={mtcnn}\n              input={this.state.inputVideo}\n              detectionParams={this.state.detectionParams}\n            >\n            {\n              ({ mtcnnResults }) => {\n                const { overlay } = this.state\n\n                if (overlay && mtcnnResults) {\n                  const { width, height } = overlay\n                  overlay.getContext('2d').clearRect(0, 0, width, height)\n                  faceapi.drawDetection(\n                    overlay,\n                    mtcnnResults.map(res => res.faceDetection.forSize(width, height))\n                  )\n                  faceapi.drawLandmarks(\n                    overlay,\n                    mtcnnResults.map(res => res.faceLandmarks.forSize(width, height))\n                  )\n\n                  this.isBusy = false\n                }\n\n                return null\n              }\n            }\n            </DetectFacesMtcnn>\n        }\n        </LoadModels>\n      </Root>\n    )\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/face_detection_webcam_mtcnn.tsx"],"sourceRoot":""}